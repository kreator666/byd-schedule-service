<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ora.blockchain.mybatis.mapper.output.OutputMapper">
    <insert id="insertOutput">
    insert into ${database}.output (`coinbase`,`wallet_account_id`,`block_hash`,`transaction_txid`, `value`, `value_sat`, `n`, `script_pub_key_asm`, `script_pub_key_hex`, `script_pub_key_req_sigs`, `script_pub_key_type`, `script_pub_key_addresses`,`create_ts`)
    values (#{pojo.coinbase},#{pojo.walletAccountId},#{pojo.blockHash},#{pojo.transactionTxid}, #{pojo.value}, #{pojo.valueSat}, #{pojo.n}, #{pojo.scriptPubKeyAsm}, #{pojo.scriptPubKeyHex}, #{pojo.scriptPubKeyReqSigs}, #{pojo.scriptPubKeyType}, #{pojo.scriptPubKeyAddresses},now())
  </insert>
    <insert id="insertOutputList">
        insert into ${database}.output (`coinbase`,`wallet_account_id`,`block_hash`,`transaction_txid`, `value`, `value_sat`, `n`,
        `script_pub_key_asm`, `script_pub_key_hex`, `script_pub_key_req_sigs`, `script_pub_key_type`,
        `script_pub_key_addresses`,`create_ts`)
        VALUES
        <foreach collection="outputList" item="pojo" index="index" separator=",">
            (#{pojo.coinbase},#{pojo.walletAccountId},#{pojo.blockHash},#{pojo.transactionTxid}, #{pojo.value}, #{pojo.valueSat}, #{pojo.n},
            #{pojo.scriptPubKeyAsm}, #{pojo.scriptPubKeyHex}, #{pojo.scriptPubKeyReqSigs}, #{pojo.scriptPubKeyType},
            #{pojo.scriptPubKeyAddresses},now())
        </foreach>
    </insert>
    <update id="updateOutput">
    UPDATE ${database}.output SET status = #{status} WHERE transaction_txid = #{transactionTxid} AND n = #{n}
  </update>
    <update id="updateOutputBatch" parameterType="java.util.List">
        <foreach collection="outputList" item="item" separator=";">
          UPDATE ${database}.output SET `status` = #{status} WHERE transaction_txid = #{item.transactionTxid} AND n = #{item.n}
        </foreach>
    </update>
    <delete id="deleteOutput">
    DELETE FROM ${database}.output WHERE block_hash = #{blockHash}
  </delete>
    <update id="updateWalletAccountId">
    UPDATE ${database}.output SET wallet_account_id = #{walletAccountId} WHERE transaction_txid = #{transactionTxid} and n = #{n}
  </update>
    <select id="queryOutputByWalletAccount" resultType="com.ora.blockchain.mybatis.entity.output.Output">
      SELECT script_pub_key_addresses AS scriptPubKeyAddresses, transaction_txid AS transactionTxid,n FROM ${database}.output WHERE wallet_account_id IS NULL
  </select>
    <select id="queryOutputByPrimary" resultType="com.ora.blockchain.mybatis.entity.output.Output">
        SELECT wallet_account_id AS walletAccountId,script_pub_key_addresses AS scriptPubKeyAddresses, transaction_txid AS transactionTxid,n FROM ${database}.output WHERE transaction_txid = #{transactionTxid} AND n = #{n} LIMIT 1
    </select>
</mapper>
